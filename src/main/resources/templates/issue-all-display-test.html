<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>

  <title>Dashboard - NiceAdmin Bootstrap Template</title>
  <meta content="" name="description"/>
  <meta content="" name="keywords"/>

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect"/>
  <link
          href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
          rel="stylesheet"
  />

  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Favicons -->
  <link th:href="@{/images/favicon.png}" rel="icon">
  <link th:href="@{/images/apple-touch-icon.png}" rel="apple-touch-icon">

  <link
          th:href="@{/vendor/bootstrap-icons/bootstrap-icons.css}"
          rel="stylesheet"
  />
  <link href="/vendor/boxicons/css/boxicons.min.css" rel="stylesheet"/>
  <link href="/vendor/remixicon/remixicon.css" rel="stylesheet"/>

  <!-- Template Main CSS File -->
  <link href="/css/style.css" rel="stylesheet"/>
  <style>
    .issue-card {
      margin-bottom: 20px;
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
    }

    .issue-card:hover {
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .issue-card:hover {
      transform: scale(1.02);
    }

    .card-header {
      background: linear-gradient(to right, #6a0572, #00b4d8);
      color: #fff;
      border-bottom: none;
    }

    .card-body {
      padding: 10px;
    }


    .pagination-container {
      margin-top: 20px;
    }

    .input-container {
      margin-bottom: 20px;
    }

    .card {
      border-radius: 20px;
    }

    .uploaded-info {
      font-size: 1em;
      color: #666;
      text-align: right;
      float: right; /* Add this line to float the element to the right */
      margin-top: -20px; /* Adjust the margin if necessary */
    }

    input[type="text"] {
      padding: 10px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
  </style>

  <style>

    .cool-box {
      width: 100%;
    }

    .cool-div {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
<!-- ======= Header ======= -->
<div th:replace="fragments/header :: header"></div>
<div th:replace="fragments/sidebar :: #sidebar"></div>

<!-- Start #main -->
<main id="main" class="main">
  <div class="page-title">
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
        <li class="breadcrumb-item active">Issue</li>
      </ol>
    </nav>
  </div>
  <!-- End Page Title -->
  <div class="container" style="padding: 15px">

    <div class="row">
      <div class="col-md-6">
        <h4><i class="bi bi-search"></i> Issue Page</h4>
      </div>
      <div class="col-md-6 text-end">
        <!-- Move the "Create Issue" button to the right -->
        <a class="btn btn-primary" th:href="@{/issue-create}">Create Issue</a>
      </div>
    </div>
    <!-- Search Box -->
    <div class="search-box mb-3">
      <label for="issueSearch"></label>
      <input type="text" id="issueSearch" placeholder="Search issues...">
    </div>


    <div class="row cool-div">
      <div class="col-md-6 col-lg-3">
        <label for="issuesPerPage" class="cool-label">Issues Per Page:</label>
        <select id="issuesPerPage" class="form-select cool-box" onchange="changePerPage(this.value)">
          <option value="3" selected>3</option>
          <option value="5">5</option>
          <option value="10">10</option>
        </select>
      </div>
      <div class="col-md-6 col-lg-3">
        <label for="sortBy" class="cool-label">Filter By Status:</label>
        <select id="sortBy" class="form-select cool-box" onchange="sortIssues(this.value)">
          <option value="all">All</option>
          <option value="open">Open</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      <div class="col-md-6 col-lg-3">
        <label for="sortMonth" class="cool-label">Filter By Month:</label>
        <select id="sortMonth" class="form-select cool-box">
          <option value="all">All</option>
          <option value="01">January</option>
          <option value="02">February</option>
          <option value="03">March</option>
          <option value="04">April</option>
          <option value="05">May</option>
          <option value="06">June</option>
          <option value="07">July</option>
          <option value="08">August</option>
          <option value="09">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>
      <div class="col-md-6 col-lg-3">
        <label for="sortYear" class="cool-label">Filter By Year:</label>
        <input type="number" id="sortYear" class="form-control" style="height: 38px" placeholder="Enter year"
               oninput="sortIssuesByYear(this.value)" min="2000">
      </div>
    </div>


    <!-- Issue Cards -->
    <div class="row" id="issueContainer" style="margin-top: 15px">
      <!-- Cards will be dynamically added here -->
    </div>

    <!-- Pagination -->
    <div class="pagination-container overflow-x-auto">
      <ul class="pagination" id="pagination"></ul>
    </div>
  </div>

</main>
<!-- End #main -->

<!-- Vendor JS Files -->
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<!-- Template Main JS File -->
<script src="/js/main.js"></script>

<script>


  // Sample data
  const issues = [
    {
      id: "ISU01",
      title: 'UI Alignment Problem',
      description: 'The UI elements are not aligned properly on the dashboard.',
      status: 'Open',
      assignedTo: 'John Doe',
      uploadedAt: '2023-11-01'
    },
    {
      id: "ISU02",
      title: 'Superman vs Batman',
      description: 'Unable to establish a connection with the database server.',
      status: 'Closed',
      assignedTo: 'Jane Smith',
      uploadedAt: '2023-11-01'
    },
    {
      id: "ISU03",
      title: 'UI Alignment Problem',
      description: 'The UI elements are not aligned properly on the dashboard.',
      status: 'Open',
      assignedTo: 'John Doe',
      uploadedAt: '2023-11-01'
    },
    {
      id: "ISU04",
      title: 'UI Alignment Problem',
      description: 'The UI elements are not aligned properly on the dashboard.',
      status: 'Open',
      assignedTo: 'John Doe',
      uploadedAt: '2023-11-01'
    },
    {
      id: "ISU05",
      title: 'Superman vs Batman',
      description: 'Unable to establish a connection with the database server.',
      status: 'Closed',
      assignedTo: 'Jane Smith',
      uploadedAt: '2023-11-01'
    },
    {
      id: "ISU06",
      title: 'UI Alignment Problem',
      description: 'The UI elements are not aligned properly on the dashboard.',
      status: 'Open',
      assignedTo: 'John Doe',
      uploadedAt: '2023-11-01'
    },
    // Add more issues as needed
  ];

  // Number of issues per page
  let issuesPerPage = 3;

  // Display issues initially
  displayIssues(issues, 1);

  // Attach event listener to search box
  $('#issueSearch').on('input', function () {
    const searchText = $(this).val().toLowerCase();
    const filteredIssues = issues.filter(issue =>
            issue.title.toLowerCase().includes(searchText) ||
            issue.description.toLowerCase().includes(searchText) ||
            issue.status.toLowerCase().includes(searchText) ||
            issue.assignedTo.toLowerCase().includes(searchText) ||
            issue.uploadedAt.toLowerCase().includes(searchText)
    );
    displayIssues(filteredIssues, 1);
  });

  // Attach event listener to issues per select
  function changePerPage(value) {
    issuesPerPage = parseInt(value, 10);
    displayIssues(issues, 1);
  }

  // Function to display issues as cards with pagination and sorting
  function displayIssues(issues, currentPage) {
    const issueContainer = $('#issueContainer');
    issueContainer.empty();

    const startIndex = (currentPage - 1) * issuesPerPage;
    const endIndex = startIndex + issuesPerPage;
    const issuesToShow = issues.slice(startIndex, endIndex);

    issuesToShow.forEach(issue => {
      const card = `
          <div class="col-md-12">
            <a href="issue-display#${issue.id}" class="card-link">
              <div class="card issue-card" style="border-radius:20px">
                <div class="card-header" style="border-radius:20px 20px 0 0; padding: 20px">
                  <h5 class="text-white">${issue.title}</h5>
                </div>
                <div class="card-body" style="padding:20px">
                  <p class="card-text"><strong>Description:</strong>${issue.description}</p>
                  <p class="card-text"><strong>Status:</strong> ${issue.status}</p>
                  <p class="card-text"><strong>Assigned To:</strong> ${issue.assignedTo}</p>
                  <span class="uploaded-info">Uploaded: ${issue.uploadedAt}</span>
                </div>
              </div>
            </a>
          </div>
        `;

      issueContainer.append(card);
    });

    // Update pagination
    updatePagination(issues.length, currentPage);
  }

  // Function to update pagination
  function updatePagination(totalIssues, currentPage) {
    const totalPages = Math.ceil(totalIssues / issuesPerPage);
    const pagination = $('#pagination');
    pagination.empty();

    for (let i = 1; i <= totalPages; i++) {
      const listItem = `<li class="page-item ${i === currentPage ? 'active' : ''}"><a class="page-link" href="#" onclick="changePage(${i})">${i}</a></li>`;
      pagination.append(listItem);
    }
  }

  // Function to change the current page
  function changePage(pageNumber) {
    displayIssues(issues, pageNumber);
  }

  // Function to sort issues
  function sortIssues(status) {
    const lowerCaseStatus = status.toLowerCase();
    const filteredIssues = (lowerCaseStatus === 'all') ? issues : issues.filter(issue => issue.status.toLowerCase() === lowerCaseStatus);
    displayIssues(filteredIssues, 1);
  }
</script>
<script>
  // Function to sort issues by month and year
  function sortIssuesByMonthAndYear(month, year) {
    const filteredIssues = (month === 'all' && year === 'all') ? issues : issues.filter(issue => {
      const issueMonth = new Date(issue.uploadedAt).getMonth() + 1; // Months are zero-based
      const issueYear = new Date(issue.uploadedAt).getFullYear();

      return (month === 'all' || issueMonth.toString().padStart(2, '0') === month) &&
              (year === 'all' || issueYear.toString() === year);
    });

    displayIssues(filteredIssues, 1);
  }

  // Function to handle changes in both month and year inputs
  function changeMonthAndYear() {
    const selectedMonth = document.getElementById('sortMonth').value;
    const selectedYear = document.getElementById('sortYear').value;
    sortIssuesByMonthAndYear(selectedMonth, selectedYear);
  }

  // Attach event listeners to month and year inputs
  document.getElementById('sortMonth').addEventListener('change', changeMonthAndYear);
  document.getElementById('sortYear').addEventListener('input', changeMonthAndYear);
</script>
<script>

  // Initial hide of "Create Issue" link
  toggleCreateIssueButton(true);

  // Attach event listener to search box
  $('#issueSearch').on('input', function () {
    const searchText = $(this).val().toLowerCase();
    const filteredIssues = issues.filter(issue =>
            issue.title.toLowerCase().includes(searchText) ||
            issue.description.toLowerCase().includes(searchText) ||
            issue.status.toLowerCase().includes(searchText) ||
            issue.assignedTo.toLowerCase().includes(searchText) ||
            issue.uploadedAt.toLowerCase().includes(searchText)
    );
    if(filteredIssues.length === 0) {
      $('#issueContainer').html('<h4>No issues found!!</h4>');
      toggleCreateIssueButton(false);
    } else if (searchText===''){
      toggleCreateIssueButton(true);
    } else{
      displayIssues(filteredIssues, 1);
    }
  });

  // Function to toggle the visibility of "Create Issue" button
  function toggleCreateIssueButton(shouldHide) {
    const createIssueContainer = $('.col-md-6.text-end');
    if (shouldHide) {
      createIssueContainer.hide();
    } else {
      createIssueContainer.show();
    }
  }
</script>
</body>
</html>
