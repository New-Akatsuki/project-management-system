<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>

    <title>Dashboard - NiceAdmin Bootstrap Template</title>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect"/>
    <link
            href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
            rel="stylesheet"
    />

    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Favicons -->
    <link th:href="@{/images/favicon.png}" rel="icon">
    <link th:href="@{/images/apple-touch-icon.png}" rel="apple-touch-icon">

    <link
            th:href="@{/vendor/bootstrap-icons/bootstrap-icons.css}"
            rel="stylesheet"
    />
    <link href="/vendor/boxicons/css/boxicons.min.css" rel="stylesheet"/>
    <link href="/vendor/remixicon/remixicon.css" rel="stylesheet"/>

    <!-- Template Main CSS File -->
    <link href="/css/style.css" rel="stylesheet"/>
    <style>
        .issue-card {
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
        }

        .issue-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            background-color: #007bff;
            color: #fff;
            border-bottom: none;
        }

        .card-body {
            padding: 10px;
        }

        .card-footer {
            background-color: #f8f9fa;
        }

        .pagination-container {
            margin-top: 20px;
        }

        .input-container {
            margin-bottom: 20px;
        }

        .card {
            border-radius: 10px;
        }
    </style>

</head>

<body>
<!-- ======= Header ======= -->
<div th:replace="fragments/header :: header"></div>
<div th:replace="fragments/sidebar :: #sidebar"></div>

<!-- Start #main -->
<main id="main" class="main">
    <div class="page-title">
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
                <li class="breadcrumb-item active">Issue</li>
            </ol>
        </nav>
    </div>
    <!-- End Page Title -->
    <div class="card" style="padding: 20px">

        <h4><i class="bi bi-search"></i> Issue Page</h4>
        <a class="btn btn-primary position-absolute top-0 end-0 mt-4 me-4" th:href="@{/issue-display-page}">Create
            Issue</a>

        <div class="container" style="padding: 5px">

            <!-- Number of cards per page input and Sort By Status Dropdown -->
            <div class="d-flex justify-content-between mt-3 gap-2">
                <div class="flex-3 d-flex flex-column flex-md-row align-items-start align-items-md-center gap-1 gap-md-0">
                    <label for="issuesPerPage" class="flex-4">Issues Per Page:</label>
                    <select id="issuesPerPage" class="form-select flex-3" onchange="changePerPage(this.value)">
                        <option value="3" selected>3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select>
                  <div class="flex-3 d-none d-md-block"></div>
                </div>


                <div class="flex-3 d-flex flex-column flex-md-row align-items-start align-items-md-center gap-1 gap-md-0">
                  <div class="flex-3 d-none d-md-block"></div>
                    <label for="sortBy" class="flex-4">Sort By Status:</label>
                    <select id="sortBy" class="form-select flex-3" onchange="sortIssues(this.value)">
                        <option value="all">All</option>
                        <option value="open">Open</option>
                        <option value="closed">Closed</option>
                    </select>

                </div>
            </div>

          <!-- Search Box -->
          <div class="search-box mb-3">
            <label for="issueSearch"></label>
            <input type="text" class="form-control" id="issueSearch" placeholder="Search issues...">
          </div>

            <!-- Issue Cards -->
            <div class="row" id="issueContainer">
                <!-- Cards will be dynamically added here -->
            </div>

            <!-- Pagination -->
            <div class="pagination-container overflow-x-auto">
                <ul class="pagination" id="pagination"></ul>
            </div>
        </div>

    </div>
</main>
<!-- End #main -->

<!-- Vendor JS Files -->
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<!-- Template Main JS File -->
<script src="/js/main.js"></script>

<script>
    // Sample data
    const issues = [
        {
            id: "ISU01",
            title: 'UI Alignment Problem',
            description: 'The UI elements are not aligned properly on the dashboard.',
            status: 'Open',
            assignedTo: 'John Doe'
        },
        {
            id: "ISU02",
            title: 'Superman vs Batman',
            description: 'Unable to establish a connection with the database server.',
            status: 'Closed',
            assignedTo: 'Jane Smith'
        },
        {
            id: "ISU03",
            title: 'UI Alignment Problem',
            description: 'The UI elements are not aligned properly on the dashboard.',
            status: 'Open',
            assignedTo: 'John Doe'
        },
        {
            id: "ISU04",
            title: 'UI Alignment Problem',
            description: 'The UI elements are not aligned properly on the dashboard.',
            status: 'Open',
            assignedTo: 'John Doe'
        },
        {
            id: "ISU05",
            title: 'Superman vs Batman',
            description: 'Unable to establish a connection with the database server.',
            status: 'Closed',
            assignedTo: 'Jane Smith'
        },
        {
            id: "ISU06",
            title: 'UI Alignment Problem',
            description: 'The UI elements are not aligned properly on the dashboard.',
            status: 'Open',
            assignedTo: 'John Doe'
        },
        // Add more issues as needed
    ];

    // Number of issues per page
    let issuesPerPage = 3;

    // Display issues initially
    displayIssues(issues, 1);

    // Attach event listener to search box
    $('#issueSearch').on('input', function () {
        const searchText = $(this).val().toLowerCase();
        const filteredIssues = issues.filter(issue =>
            issue.title.toLowerCase().includes(searchText) ||
            issue.description.toLowerCase().includes(searchText) ||
            issue.status.toLowerCase().includes(searchText) ||
            issue.assignedTo.toLowerCase().includes(searchText)
        );
        displayIssues(filteredIssues, 1);
    });

    // Attach event listener to issues per select
    function changePerPage(value) {
        issuesPerPage = parseInt(value, 10);
        displayIssues(issues, 1);
    }

    // Function to display issues as cards with pagination and sorting
    function displayIssues(issues, currentPage) {
        const issueContainer = $('#issueContainer');
        issueContainer.empty();

        const startIndex = (currentPage - 1) * issuesPerPage;
        const endIndex = startIndex + issuesPerPage;
        const issuesToShow = issues.slice(startIndex, endIndex);

        issuesToShow.forEach(issue => {
            const card = `
          <div class="col-md-12">
            <a href="issue-display#${issue.id}" class="card-link">
              <div class="card issue-card">
                <div class="card-header">
                  <h5 class="text-white">${issue.title}</h5>
                </div>
                <div class="card-body">
                  <p class="card-text"><strong>Description:</strong>${issue.description}</p>
                  <p class="card-text"><strong>Status:</strong> ${issue.status}</p>
                  <p class="card-text"><strong>Assigned To:</strong> ${issue.assignedTo}</p>
                </div>
              </div>
            </a>
          </div>
        `;

            issueContainer.append(card);
        });

        // Update pagination
        updatePagination(issues.length, currentPage);
    }

    // Function to update pagination
    function updatePagination(totalIssues, currentPage) {
        const totalPages = Math.ceil(totalIssues / issuesPerPage);
        const pagination = $('#pagination');
        pagination.empty();

        for (let i = 1; i <= totalPages; i++) {
            const listItem = `<li class="page-item ${i === currentPage ? 'active' : ''}"><a class="page-link" href="#" onclick="changePage(${i})">${i}</a></li>`;
            pagination.append(listItem);
        }
    }

    // Function to change the current page
    function changePage(pageNumber) {
        displayIssues(issues, pageNumber);
    }

    // Function to sort issues
    function sortIssues(status) {
        const lowerCaseStatus = status.toLowerCase();
        const filteredIssues = (lowerCaseStatus === 'all') ? issues : issues.filter(issue => issue.status.toLowerCase() === lowerCaseStatus);
        displayIssues(filteredIssues, 1);
    }

</script>
</body>

</html>
