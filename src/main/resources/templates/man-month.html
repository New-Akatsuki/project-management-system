<!DOCTYPE html>
<html lang="en">
<head>
  <title>Man-Month Filter</title>
</head>
<body>
<h1>Man-Month Filter</h1>
<label for="monthSelector">Select a month:</label>
<select id="monthSelector">
  <option value="01">January</option>
  <option value="02">February</option>
  <option value="03">March</option>
  <option value="04">April</option>
  <option value="05">May</option>
  <option value="06">June</option>
  <option value="07">July</option>
  <option value="08">August</option>
  <option value="09">September</option>
  <option value="10">October</option>
  <option value="11">November</option>
  <option value="12">December</option>
</select>

<button id="productivityRatioBtn">Calculate Productivity Ratio</button>
<div id="result"></div>

<div>
  <canvas id="barChart" width="400px" height="400px"></canvas>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>

  const monthNames = [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"
  ];

  // Fetch the actual task data using AJAX
  $.get("/get-task-data", function(data) {
    // Filter main tasks (tasks with parent set to null)
    const mainTasks = data.filter(task => task.parent === null);

    // Function to calculate man-months for a specific month
    function calculatePlanManMonth(tasks, selectedMonth) {
      let planManMonth = 0;

      // Iterate through the main tasks
      for (const task of tasks) {
        // Check if the task has start_date or end_date in the selected month
        if (
                (task.start_date && task.start_date.startsWith(`2023-${selectedMonth}`)) ||
                (task.end_date && task.end_date.startsWith(`2023-${selectedMonth}`))
        )

        {
          // Calculate man-months based on planned hours
          planManMonth += task.plan_hours / (8 * 20); // Assuming 8 working hours per day and 20 working days per month
        }
      }

      return planManMonth;


    }



    function calculateActualManMonth(tasks, selectedMonth){
      let actualManMonth = 0;

      for(const task of tasks){
        if(
                (task.start_date && task.start_date.startsWith(`2023-${selectedMonth}`)) ||
                (task.actual_due_date && task.actual_due_date.startsWith(`2023-${selectedMonth}`))
        )
        {
          actualManMonth += task.actual_hours / (8 * 20);
        }
      }
      return actualManMonth;
    }



    //target productivity ratio for each month
    function calculateProductivityRatio(plan, actual) {
      return (actual / plan) * 100;
    }

    // Add a click event listener to the calculate button
    // Add an event listener to the monthSelector dropdown
    document.getElementById("monthSelector").addEventListener("change", function() {
      const selectedMonth = this.value;
      const taskPlanManMonth = calculatePlanManMonth(mainTasks, selectedMonth);
      const taskActualManMonth = calculateActualManMonth(mainTasks, selectedMonth);


      document.getElementById("result").textContent = `
        Plan Man Month in ${monthNames[selectedMonth - 1]}: ${taskPlanManMonth}
        Actual Man Month in ${monthNames[selectedMonth - 1]}: ${taskActualManMonth}
      `;

    });
    document.getElementById("productivityRatioBtn").addEventListener("click", function() {
      const selectedMonth = document.getElementById("monthSelector").value;
      const planManMonth = calculatePlanManMonth(mainTasks, selectedMonth);
      const actualManMonth = calculateActualManMonth(mainTasks, selectedMonth);
      const productivityRatio = calculateProductivityRatio(planManMonth, actualManMonth);
      document.getElementById("result").textContent = `Productivity Ratio in ${monthNames[selectedMonth - 1]}: ${productivityRatio.toFixed(2)}%`;
    });
  });








</script>
</body>
</html>
